<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Babylon â€” 3rd Person Sphere</title>
  <link rel="icon" href="awodas.png" type="image/png">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>

  <style>
    html, body {
      width:100%;
      height:100%;
      margin:0;
      overflow:hidden;
      font-family: Inter, system-ui, sans-serif;
      background:#000;
    }

    #renderCanvas {
      width:100%;
      height:100%;
      touch-action:none;
      display:block;
    }

    #ui {
      position: absolute;
      left: 12px;
      top: 12px;
      z-index: 50;
      color: white;
      text-shadow: 0 2px 6px rgba(0,0,0,0.7);
      user-select: none;
    }

    #coinCounter {
      background: rgba(0,0,0,0.45);
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 18px;
      min-width: 120px;
    }

    #multiplier {
      margin-top: 8px;
      background: rgba(0,0,0,0.35);
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
    }

    /* AUDIO START SCREEN */
    #audioGate {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      color: white;
      font-size: 24px;
      cursor: pointer;
      text-align: center;
    }
    #audioGate span {
      background: #111;
      padding: 20px 30px;
      border-radius: 12px;
      border: 2px solid #444;
    }
  </style>

  <!-- Babylon Libraries -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/materialsLibrary/babylon.waterMaterial.min.js"></script>
  <script src="https://cdn.babylonjs.com/earcut.min.js"></script>
  <script src="https://cdn.babylonjs.com/cannon.js"></script>

  <!-- Game Scripts -->
  <script src="bgmusic.js" defer></script>
</head>

<body>

  <canvas id="renderCanvas"></canvas>

  <div id="ui">
    <div id="coinCounter">Coins: <span id="coinsValue">0</span></div>
    <div id="multiplier" style="display:none;">
      Multiplier: <span id="multValue">2x</span> â€” <span id="multTime">30</span>s
    </div>
  </div>


<script>
window.addEventListener("DOMContentLoaded", () => {
  const canvas = document.getElementById("renderCanvas");
  const engine = new BABYLON.Engine(canvas, true);

  const SETTINGS = {
    groundTopColor: "#33FF4B",
    roadColor: "#111111",
    buildingColor: "#BBBBBB",
    windowColor: new BABYLON.Color3(1, 0.85, 0.4),
    lightColor: new BABYLON.Color3(1, 0.9, 0.6),
    citySpacing: 40,
    roadWidth: 8,
    dayNightCycleMs: 180000
  };

  function rnd(min, max) { return Math.random() * (max - min) + min; }

  function createBoxMaterial(scene, color) {
    const m = new BABYLON.StandardMaterial("mat_" + Math.random(), scene);
    if (typeof color === "string") m.diffuseColor = BABYLON.Color3.FromHexString(color);
    else m.diffuseColor = color;
    return m;
  }

  const buildings = [];
  const streetLights = [];

  function createStreetLight(scene, x, z) {
    const pole = BABYLON.MeshBuilder.CreateCylinder("pole", {
      height: 8,
      diameterTop: 0.2,
      diameterBottom: 0.4
    }, scene);
    pole.position.set(x, 4, z);
    pole.material = createBoxMaterial(scene, "#333");

    const bulb = BABYLON.MeshBuilder.CreateSphere("bulb", { diameter: 0.6 }, scene);
    bulb.position.set(x, 8.3, z);

    const bulbMat = new BABYLON.StandardMaterial("bulbMat", scene);
    bulbMat.emissiveColor = SETTINGS.lightColor;
    bulb.material = bulbMat;

    const light = new BABYLON.PointLight("streetLight", new BABYLON.Vector3(x, 8.3, z), scene);
    light.intensity = 0.2;
    light.range = 25;

    streetLights.push({ material: bulbMat, light });
  }

  function createBuilding(scene, x, z) {
    const width = rnd(8, 14);
    const depth = rnd(8, 14);
    const height = rnd(10, 30);

    const b = BABYLON.MeshBuilder.CreateBox("building", { width, height, depth }, scene);
    b.position.set(x, height/2, z);

    const mat = createBoxMaterial(scene, SETTINGS.buildingColor);
    mat.emissiveColor = SETTINGS.windowColor.scale(0.05);
    b.material = mat;

    buildings.push(mat);
  }

  function createScene() {
    const scene = new BABYLON.Scene(engine);

    const hemi = new BABYLON.HemisphericLight("hemi", new BABYLON.Vector3(0,1,0), scene);
    hemi.intensity = 1;

    scene.clearColor = new BABYLON.Color3(0.6, 0.8, 1);

    const ground = BABYLON.MeshBuilder.CreateGround("ground", {
      width: 600,
      height: 600
    }, scene);
    ground.material = createBoxMaterial(scene, SETTINGS.groundTopColor);

    for (let x = -280; x < 280; x += SETTINGS.citySpacing) {
      for (let z = -280; z < 280; z += SETTINGS.citySpacing) {
        if (Math.random() > 0.35) createBuilding(scene, x, z);
        if (Math.random() > 0.7) createStreetLight(scene, x + 10, z + 10);
      }
    }

    const camera = new BABYLON.ArcRotateCamera("cam", Math.PI/2, Math.PI/3, 120, BABYLON.Vector3.Zero(), scene);
    camera.attachControl(canvas, true);

    // ðŸŒ— DAY / NIGHT SYSTEM
    scene.onBeforeRenderObservable.add(() => {
      const t = (Date.now() % SETTINGS.dayNightCycleMs) / SETTINGS.dayNightCycleMs;
      const nightFactor = Math.sin(t * Math.PI * 2) * 0.5 + 0.5;

      hemi.intensity = 0.3 + (1 - nightFactor) * 0.9;
      scene.clearColor = new BABYLON.Color3(
        0.05 + (1 - nightFactor) * 0.6,
        0.05 + (1 - nightFactor) * 0.6,
        0.1 + (1 - nightFactor) * 0.7
      );

      buildings.forEach(mat => {
        mat.emissiveColor = SETTINGS.windowColor.scale(nightFactor * 1.2);
      });

      streetLights.forEach(l => {
        l.light.intensity = nightFactor * 1.5;
      });
    });

    return scene;
  }

  const scene = createScene();
  engine.runRenderLoop(() => scene.render());
  window.addEventListener("resize", () => engine.resize());
});
</script>


</body>
</html>
